# ======================
# 目标架构与固件基础配置
# ======================
CONFIG_TARGET_x86=y
CONFIG_TARGET_x86_64=y
CONFIG_TARGET_x86_64_DEVICE_generic=y
CONFIG_TARGET_KERNEL_PARTSIZE=32
CONFIG_TARGET_ROOTFS_PARTSIZE=944
CONFIG_GRUB_EFI_IMAGES=y
CONFIG_TARGET_IMAGES_GZIP=y
CONFIG_TARGET_ROOTFS_SQUASHFS=y

# ======================
# 工具链与编译优化（J4125专用）
# ======================
CONFIG_KERNEL_CLANG_LLVM=y
CONFIG_LLVM_TARGET_ARCH="x86-64-v2"
CONFIG_USE_LLD=y
CONFIG_LTO_CLANG_THIN=y
CONFIG_KERNEL_LTO=y
CONFIG_KERNEL_OPTIMIZE_O3=y
CONFIG_OPTIMIZE_FOR_SIZE=n
CONFIG_OPTIMIZE_INLINING=y
CONFIG_CC_OPTIMIZE_FOR_PERFORMANCE=y
CONFIG_ZLIB_OPTIMIZE_SPEED=y
CONFIG_LLVM_DISTRIBUTION_COMPONENTS="clang;lld"

# ======================
# x86架构核心优化
# ======================
CONFIG_64BIT=y
CONFIG_X86_64=y
CONFIG_RETPOLINE=y
CONFIG_IOMMU_SUPPORT=y
CONFIG_PCI=y
CONFIG_PCI_MSI=y
CONFIG_HIGH_RES_TIMERS=y
CONFIG_SOFTIRQ_ON_OWN_STACK=y
CONFIG_MTRR=y
CONFIG_CPU_FREQ_DEFAULT_GOV_PERFORMANCE=y
CONFIG_SCHED_MC=y
CONFIG_SCHED_SMT=y
# +++ 新增：抢占模式优化，降低延迟 +++
CONFIG_PREEMPT_VOLUNTARY=n
CONFIG_PREEMPT=y
# +++ 新增：定时器频率提升，改善响应性 +++
CONFIG_HZ=1000
CONFIG_HZ_1000=y

# ======================
# Intel硬件深度优化（J4125+I226）
# ======================
CONFIG_INTEL_PSTATE=y
CONFIG_INTEL_PSTATE_HWP=y
CONFIG_INTEL_IDLE=y
CONFIG_IGC=y                      
CONFIG_IGC_RX_NAPI=y
CONFIG_IGC_TX_NAPI=y
CONFIG_IGC_GRO=y
CONFIG_IGC_GSO=y
CONFIG_IGC_TSO=y
CONFIG_IGC_DIM=y
CONFIG_IGC_XDP=y                 
CONFIG_IRQ_AFFINITY_HINT=y       
CONFIG_GENERIC_IRQ_IPI=y
CONFIG_IRQ_DOMAIN_HIERARCHY=y
CONFIG_XPS=y                     
CONFIG_RFS_ACCEL=y              
CONFIG_NET_RX_BUSY_POLL=y
CONFIG_NET_RX_BUSY_POLL_DEFAULT=200        
CONFIG_MICROCODE_INTEL=y
CONFIG_MICROCODE_LATE_LOADING=y

# ======================
# 内存管理优化（8GB低开销）
# ======================
CONFIG_SLUB=y
CONFIG_SLUB_CPU_PARTIAL=y
CONFIG_PAGE_POOL=y                
CONFIG_TRANSPARENT_HUGEPAGE=y
CONFIG_TRANSPARENT_HUGEPAGE_MADVISE=y 
CONFIG_SLUB_DEBUG=n
CONFIG_SLUB_CPU_PARTIAL_DEFAULT=16

# ======================
# 网络协议栈高性能配置
# ======================
CONFIG_TCP_CONG_BBR3=y    
CONFIG_NET_SCH_DEFAULT=y
CONFIG_DEFAULT_FQ_CODEL=y         
CONFIG_TCP_FASTOPEN=y
CONFIG_PACKET=y                  
CONFIG_INET_DIAG=y                
CONFIG_SYN_COOKIES=y              
CONFIG_UDP_GRO=y                  
CONFIG_NET_SCH_FQ_CODEL=y
CONFIG_NET_SCH_CAKE=n
CONFIG_NET_SCH_FQ=y
CONFIG_XDP_SOCKETS=y
CONFIG_TCP_NOTSENT_LOWAT=16384           
CONFIG_TCP_MD5SIG=y
CONFIG_TCP_AO=y
CONFIG_INET_ESP=y
CONFIG_NET_SCH_MQPRIO=n

# ======================
# Netfilter/NAT硬件卸载
# ======================
CONFIG_NETFILTER=y
CONFIG_NF_CONNTRACK=y
CONFIG_NF_CONNTRACK_IPV4=y
CONFIG_NF_NAT=y
CONFIG_NF_NAT_MASQUERADE_IPV4=y
CONFIG_NF_TABLES=y
CONFIG_NF_TABLES_NETDEV=y        
CONFIG_NFT_NAT=y
CONFIG_NFT_MASQ=y
CONFIG_NETFILTER_FLOW_OFFLOAD=y  
CONFIG_NF_FLOW_TABLE=y
CONFIG_NF_CONNTRACK_EVENTS=y
CONFIG_NF_CONNTRACK_TIMEOUT=y

# ======================
# 必要内核模块（精简版）
# ======================
CONFIG_PACKAGE_kmod-tcp-bbr=y     
CONFIG_PACKAGE_kmod-nft-core=y
CONFIG_PACKAGE_kmod-nft-netdev=y
CONFIG_PACKAGE_kmod-nft-offload=y
CONFIG_PACKAGE_kmod-nf-conntrack=y
CONFIG_PACKAGE_kmod-nf-nat=y

# ======================
# 用户态工具（性能监控/调优）
# ======================
CONFIG_PACKAGE_ethtool=y          
CONFIG_PACKAGE_irqbalance=y       
CONFIG_PACKAGE_libnftnl=y
CONFIG_PACKAGE_iperf3=y
CONFIG_PACKAGE_ip-full=y         

# ======================
# LuCI应用配置 (精简实用)
# ======================
CONFIG_PACKAGE_luci-app-arpbind=y
CONFIG_PACKAGE_luci-app-oaf=y
CONFIG_PACKAGE_luci-app-filemanager=y
CONFIG_PACKAGE_luci-app-irqbalance=y
CONFIG_PACKAGE_luci-app-firewall=y

# ======================
# 生产环境调试精简
# ======================
CONFIG_DEBUG_INFO=n               # 关闭调试符号减少内存
CONFIG_SLUB_DEBUG=n               # 关闭SLUB调试
CONFIG_PROFILING=n                # 关闭性能剖析
CONFIG_NET_DROP_MONITOR=n         # 关闭丢包监控
CONFIG_FTRACE=n                   # 关闭跟踪框架
CONFIG_KPROBES=n                  # 关闭探测点
# +++ 优化：关闭更多调试功能 +++
CONFIG_DEBUG_KERNEL=n
CONFIG_DEBUG_MISC=n
CONFIG_DEBUG_LIST=n