# ======================
# 目标架构与固件配置
# ======================
CONFIG_64BIT=y
CONFIG_X86_64=y
CONFIG_TARGET_x86=y
CONFIG_TARGET_x86_64=y
CONFIG_TARGET_x86_64_DEVICE_generic=y
CONFIG_TARGET_KERNEL_PARTSIZE=32
CONFIG_TARGET_ROOTFS_PARTSIZE=944
CONFIG_TARGET_IMAGES_GZIP=y
CONFIG_TARGET_ROOTFS_SQUASHFS=y
CONFIG_GRUB_EFI_IMAGES=y
CONFIG_GRUB_TIMEOUT=1

# ======================
# GCC 14 编译工具链配置
# ======================
CONFIG_TOOLCHAINOPTS=y
CONFIG_GCC_USE_VERSION_14=y
CONFIG_GCC_VERSION="14"
CONFIG_GCC_USE_GRAPHITE=y
CONFIG_GCC_DEFAULT_PIE=y
CONFIG_GCC_DEFAULT_SSP=y

# ======================
# 优化配置
# ======================
CONFIG_OPTIMIZE_FOR_PERFORMANCE=y
CONFIG_USE_LTO=y
CONFIG_KERNEL_LTO=y
CONFIG_LTO_MODE_FULL=y

# ======================
# 网络协议栈硬件卸载
# ======================
CONFIG_TCP_CONG_BBR=y
CONFIG_KERNEL_TCP_CONG_BBR=y
CONFIG_DEFAULT_TCP_CONG="bbr"
CONFIG_NET_RX_BUSY_POLL=y
CONFIG_NET_TX_BUSY_POLL=y
CONFIG_NET_RX_BUSY_POLL_BUDGET=192
CONFIG_GENERIC_IRQ_EFFECTIVE_AFF_MASK=y
CONFIG_GENERIC_IRQ_MIGRATION=y
CONFIG_NFT_FULLCONE=y
CONFIG_NFT_NAT=y
CONFIG_NETFILTER=y
CONFIG_NETFILTER_XTABLES=y
CONFIG_NF_CONNTRACK=y
CONFIG_NF_NAT=y

# ======================
# 硬件流量分类与QoS卸载
# ======================
CONFIG_NET_SCH_FQ=y
CONFIG_NET_SCH_FQ_CODEL=y
CONFIG_NET_SCH_CAKE=y
CONFIG_NF_FLOW_TABLE=y
CONFIG_NF_FLOW_TABLE_HW=y
CONFIG_ZERO_COPY=y
CONFIG_SCHED_EEVDF=y
CONFIG_PSI=y
CONFIG_IRQ_TIME_ACCOUNTING=y
CONFIG_SCHED_CORE=y
CONFIG_FAIR_GROUP_SCHED=y
CONFIG_SCHED_AUTOGROUP=y
CONFIG_SMP=y
CONFIG_SMT=y
CONFIG_NET=y
CONFIG_MMAP=y
CONFIG_DMA_ENGINE=y
CONFIG_AIO=y

# ======================
# 内核模块配置 - Netfilter核心模块
# ======================
CONFIG_PACKAGE_kmod-nft-core=y
CONFIG_PACKAGE_kmod-nft-nat=y
CONFIG_PACKAGE_kmod-nft-netdev=y
CONFIG_PACKAGE_kmod-nft-offload=y
CONFIG_PACKAGE_kmod-nft-queue=y
CONFIG_PACKAGE_kmod-nft-socket=y
CONFIG_PACKAGE_kmod-nft-fib=y
CONFIG_PACKAGE_kmod-nft-ct=y
CONFIG_PACKAGE_kmod-nft-compat=y
CONFIG_PACKAGE_kmod-nft-reject=y

# ======================
# NFTables 增强内核模块
# ======================
CONFIG_PACKAGE_kmod-nft-chain-nat=y
CONFIG_PACKAGE_kmod-nft-flow-offload=y
CONFIG_PACKAGE_kmod-nft-fullcone=y

# ======================
# 内核模块配置 - Connection Tracking
# ======================
CONFIG_PACKAGE_kmod-nf-conntrack=y
CONFIG_PACKAGE_kmod-nf-conntrack-netlink=y
CONFIG_PACKAGE_kmod-nf-conntrack6=y
CONFIG_PACKAGE_kmod-nf-nat=y
CONFIG_PACKAGE_kmod-nf-nat6=y
CONFIG_PACKAGE_kmod-nf-reject=y
CONFIG_PACKAGE_kmod-nf-reject6=y
CONFIG_PACKAGE_kmod-nf-flow=y
CONFIG_PACKAGE_kmod-nf-tproxy=y
CONFIG_PACKAGE_kmod-nf-socket=y

# ======================
# 内核模块配置 - 调度与QoS
# ======================
CONFIG_PACKAGE_kmod-sched=y
CONFIG_PACKAGE_kmod-sched-core=y
CONFIG_PACKAGE_kmod-sched-cake=y
CONFIG_PACKAGE_kmod-ifb=y
CONFIG_PACKAGE_kmod-fs-squashfs=y
CONFIG_PACKAGE_kmod-ip6tables=y
CONFIG_PACKAGE_kmod-ipt-offload=y

# ======================
# 用户态工具包 - Netfilter管理工具
# ======================
CONFIG_PACKAGE_nftables-json=y
CONFIG_PACKAGE_ipset=y
CONFIG_PACKAGE_conntrack=y

# ======================
# 用户态工具包 - 网络基础工具
# ======================
CONFIG_PACKAGE_ethtool=y
CONFIG_PACKAGE_iperf3=y
CONFIG_PACKAGE_ip-full=y

# ======================
# 用户态工具包 - Netfilter库依赖
# ======================
CONFIG_PACKAGE_libnetfilter-conntrack=y
CONFIG_PACKAGE_libnfnetlink=y
CONFIG_PACKAGE_libnftnl=y
CONFIG_PACKAGE_libmnl=y
CONFIG_PACKAGE_libipset=y
CONFIG_PACKAGE_ip6tables=y

# ======================
# 用户态工具包 - 系统工具
# ======================
CONFIG_PACKAGE_sed=y
CONFIG_PACKAGE_gawk=y
CONFIG_PACKAGE_grep=y
CONFIG_PACKAGE_coreutils-sort=y

# ======================
# LuCI应用模块 (网络优化版)
# ======================
CONFIG_PACKAGE_luci-app-arpbind=y
CONFIG_PACKAGE_luci-app-oaf=y
CONFIG_PACKAGE_luci-app-filemanager=y
CONFIG_PACKAGE_luci-app-irqbalance=y
CONFIG_PACKAGE_luci-app-firewall=y
CONFIG_PACKAGE_luci-app-sqm=y
CONFIG_PACKAGE_luci-app-adblock-fast=y